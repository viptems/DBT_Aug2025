# autocommit, Commit, and Rollback
SAVEPOINT, ROLLBACK, and COMMIT are `transaction control` commands. They are used to manage how and when changes are made permanent in the database.

If autocommit mode is enabled, each SQL statement forms a single transaction on its own. By default, MySQL starts the session for each new connection with autocommit enabled (1).

If autocommit mode is disabled within a session with SET autocommit = 0, the session always has a transaction open. A COMMIT or ROLLBACK statement ends the current transaction and a new one starts.

If a session that has autocommit disabled ends without explicitly committing the final transaction, MySQL rolls back that transaction.

A `COMMIT` means that the changes made in the current transaction are made permanent and become visible to other sessions. A `ROLLBACK` statement, on the other hand, cancels all modifications made by the current transaction. Both COMMIT and ROLLBACK release all InnoDB locks that were set during the current transaction.

### Grouping DML Operations with Transactions

By default, connection to the MySQL server begins with autocommit mode enabled, which automatically commits every SQL statement as you execute it. This mode of operation might be unfamiliar if you have experience with other database systems, where it is standard practice to issue a sequence of DML statements and commit them or roll them back all together.

To use multiple-statement transactions, switch autocommit off with the SQL statement SET autocommit = 0 and end each transaction with COMMIT or ROLLBACK as appropriate. To leave autocommit on, begin each transaction with START TRANSACTION and end it with COMMIT or ROLLBACK. The following example shows two transactions. The first is committed; the second is rolled back.

```sql
mysql> CREATE TABLE customer (a INT, b CHAR (20));
Query OK, 0 rows affected (0.00 sec)
mysql> -- Do a transaction with autocommit turned on.
mysql> START TRANSACTION;
Query OK, 0 rows affected (0.00 sec)
mysql> INSERT INTO customer VALUES (10, 'Heikki');
Query OK, 1 row affected (0.00 sec)
mysql> COMMIT;
Query OK, 0 rows affected (0.00 sec)
mysql> -- Do another transaction with autocommit turned off.
mysql> SET autocommit=0;
Query OK, 0 rows affected (0.00 sec)
mysql> INSERT INTO customer VALUES (15, 'John');
Query OK, 1 row affected (0.00 sec)
mysql> INSERT INTO customer VALUES (20, 'Paul');
Query OK, 1 row affected (0.00 sec)
mysql> DELETE FROM customer WHERE b = 'Heikki';
Query OK, 1 row affected (0.00 sec)
mysql> -- Now we undo those last 2 inserts and the delete.
mysql> ROLLBACK;
Query OK, 0 rows affected (0.00 sec)
mysql> SELECT * FROM customer;
+------+--------+
| a    | b      |
+------+--------+
|   10 | Heikki |
+------+--------+
1 row in set (0.00 sec)
mysql>

```

**START TRANSACTION, COMMIT, and ROLLBACK Statements**
 These statements provide control over use of transactions:
    -`START TRANSACTION` or `BEGIN` start a new transaction.
    - `COMMIT` commits the current transaction, making its changes permanent.
    - `ROLLBACK` rolls back the current transaction, canceling its changes.
    - `SET autocommit` disables or enables the default autocommit mode for the current session.
The `SAVEPOINT` statement sets a named transaction savepoint with a name of `identifier`. If the current transaction has a savepoint with the same name, the old savepoint is deleted and a new one is set.
The `ROLLBACK TO SAVEPOINT` statement rolls back a transaction to the named savepoint without terminating the transaction

---

# MySQL Constraints

Constraints are rules applied on columns in a table to restrict invalid data and ensure correctness.
They help MySQL enforce conditions automatically so we don’t rely only on application code.

## Types of Constraints in MySQL

1. **NOT NULL**
- Ensures that a column cannot have NULL values.
- Every row must provide a value for that column.

2. **UNIQUE**
- Ensures that all values in a column are different (no duplicates).
- Unlike PK, a table can have multiple UNIQUE constraints.
- Allows one NULL (except in some SQL engines).

3. **PRIMARY KEY (PK)**
- Uniquely identifies each row in a table.
- Rules:
    - Must be unique
    - Cannot be NULL
    - Only one PK per table (but it can be composite, i.e. multiple columns)

4. **FOREIGN KEY (FK)**
- Establishes a relationship between two tables.
- Refers to the Primary Key of another table.
- Maintains referential integrity (you can’t insert a value that doesn’t exist in the parent table).

5. **DEFAULT**
- Provides a default value for a column when no value is supplied.

6. **CHECK (MySQL 8.0+)**
- Ensures values in a column satisfy a specific condition.

7. **AUTO_INCREMENT (special constraint for PKs)**
- Automatically generates a sequential number when a new row is inserted.
- Usually used with Primary Keys.

--- 
### Ex on Constraints
1. **Create database**
```sql
DROP DATABASE IF EXISTS demo_college;
CREATE DATABASE demo_college;
USE demo_college;
```
2. **Tables with constraints**
```sql
-- Students
CREATE TABLE Students (
    student_id INT AUTO_INCREMENT PRIMARY KEY,
    name       VARCHAR(50) NOT NULL,
    email      VARCHAR(100)
);

-- Courses
CREATE TABLE Courses (
    course_id   INT AUTO_INCREMENT PRIMARY KEY,
    course_name VARCHAR(100) NOT NULL,
    credits     INT NOT NULL
);

-- Enrollments
CREATE TABLE Enrollments (
    enrollment_id INT AUTO_INCREMENT PRIMARY KEY,
    student_id    INT,
    course_id     INT,
    grade         CHAR(2),

    FOREIGN KEY (student_id) REFERENCES Students(student_id),
    FOREIGN KEY (course_id)  REFERENCES Courses(course_id)
);


```

3. **Valid inserts**
```sql
INSERT INTO Students (name, email) VALUES
('Amit Sharma', 'amit@example.com'),
('Bhavna Patel', 'bhavna@example.com'),
('Chirag Mehta', NULL),
('Divya Singh', 'divya@example.com');

INSERT INTO Courses (course_name, credits) VALUES
('Databases', 4),
('Data Structures', 3),
('Operating Systems', 5),
('AI Basics', 2);

INSERT INTO Enrollments (student_id, course_id, grade) VALUES
(1, 1, 'A'),
(1, 2, 'B'),
(2, 1, 'C'),
(2, 3, 'A'),
(3, 2, NULL),
(4, 4, 'B');


```

4. **Queries**
```sql
-- Students with id greater than 2
SELECT * FROM Students WHERE student_id > 2;
-- Courses with credits <= 3
SELECT * FROM Courses WHERE credits <= 3;
-- Students not equal to id 1
SELECT * FROM Students WHERE student_id <> 1;
-- Courses with credits between 2 and 4
SELECT * FROM Courses WHERE credits BETWEEN 2 AND 4;
-- Enrollments where student_id between 2 and 4
SELECT * FROM Enrollments WHERE student_id BETWEEN 2 AND 4;
-- Students whose id is in (1, 3)
SELECT * FROM Students WHERE student_id IN (1, 3);
-- Courses not in (2, 4)
SELECT * FROM Courses WHERE course_id NOT IN (2, 4);
-- Students with no email
SELECT * FROM Students WHERE email IS NULL;
-- Enrollments where grade is not given
SELECT * FROM Enrollments WHERE grade IS NULL;
-- Students who have email
SELECT * FROM Students WHERE email IS NOT NULL;
-- Students whose name starts with 'A'
SELECT * FROM Students WHERE name LIKE 'A%';
-- Students whose name ends with 'a'
SELECT * FROM Students WHERE name LIKE '%a';
-- Students whose name has 'vi' anywhere
SELECT * FROM Students WHERE name LIKE '%vi%';
-- Students ordered by name (ascending)
SELECT * FROM Students ORDER BY name ASC;
-- Courses ordered by credits (descending)
SELECT * FROM Courses ORDER BY credits DESC;
-- Enrollments ordered by grade (NULLs will come last)
SELECT * FROM Enrollments ORDER BY grade;
```




